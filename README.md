# PLib
`plib` (short for parser library) is a collection of multiple modules, which includes a parser generator and parsers generated by it.

`plib` takes a pre-generated [`ABNF`][1] structure as input to produce a `parser`.\
`parser` will take raw text as input to generate the [`AST`][2] of it.

> [!NOTE]
> Contribution is much welcomed, but beware that currently this is just a personal project for fun.

> [!WARNING]
> Lack of comments and documents. You need to dig into the bare code to use and knew the logic behind the library.

## Modules
- [`plib`][3]\
  core module, parser generator
- [`abnf`][4]\
  abnf file parser/serializer, `ABNF` structure generator, generate itself
- [`toml`][5]\
  toml file parser/serializer, follow toml v1.0.0, passed all (`toml-test`)[7] tests

## How To

### Generate ABNF
Use following command to generate the `ABNF` structure that defines ABNF syntax.
```
zig build -Dstep=gen_abnf -Dname=file_name
```
This command runs [`gen_abnf.zig`][6], takes `src/raw/<file_name>.abnf` and outputs `src/gen/<file_name>.zig`.

### Test Module
Use following command to test <mod_name> module.
```
zig build -Dstep=test -Dname=mod_name
```

### toml-test
To test the `toml` module against (`toml-test`)[7], first make sure `toml-test` is on your PATH, then
```
zig build -Dstep=toml_test
```
Currently all tests is passed.
```
toml-test v2024-05-31 [C:\repo\repo.zig\plib\zig-out\bin\toml_encoder.exe]: using embedded tests
encoder tests: 182 passed,  0 failed
toml-test v2024-05-31 [C:\repo\repo.zig\plib\zig-out\bin\toml_decoder.exe]: using embedded tests
  valid tests: 182 passed,  0 failed
invalid tests: 371 passed,  0 failed
```

### Add New Parser
Suppose you want to add a json parser (maybe not since it's included in std lib). You should:
1. Add `src/raw/json.abnf`, which contains json's abnf definition.
2. Run `zig build -Dstep=gen_abnf -Dname=json` to generate `src/gen/json.zig`.
3. Modify `zig.build` (and `zig.build.zong` if so desired) to build a `json` module.
4. Add `src/mod/json/root.zig`, which is the root source file of `json` module. See [`src/mod/toml/root.zig`](src/mod/toml/root.zig) for example.
5. If you are using vscode, you might also want to modify `.vscode/tasks.json`.

### Use As Dependency
In your `build.zig.zon` add:
```zig
  .dependencies = .{
    .plib = .{
      .url = "https://github.com/Luna1996/abnf/archive/main.tar.gz",
    },
  },
```
In your `build.zig` add:
```zig
const plib_dep = b.dependency("plib", .{.toml = true});
const plib_mod = plib_dep.module("plib");
const toml_mod = plib_dep.module("toml");
main_mod.addImport("plib", plib);
main_mod.addImport("plib", toml);
```
In your project add:
```zig
const plib = @import("plib");
const toml = @import("toml");
```

[1]: https://en.wikipedia.org/wiki/Augmented_Backus%E2%80%93Naur_form
[2]: https://en.wikipedia.org/wiki/Abstract_syntax_tree
[3]: https://github.com/Luna1996/abnf/tree/main/src/lib
[4]: https://github.com/Luna1996/abnf/tree/main/src/mod/abnf
[5]: https://github.com/Luna1996/abnf/tree/main/src/mod/toml
[6]: https://github.com/Luna1996/abnf/tree/main/src/exe/gen_abnf.zig
[7]: https://github.com/toml-lang/toml-test